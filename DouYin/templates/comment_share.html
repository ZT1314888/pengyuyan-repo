{% extends 'base.html' %}

{% block content %}
<div class="page-content">
    {% include 'components/page_header.html' with icon='fa-comments' title='评论与分享关系分析' %}
    {% include 'components/chart_container.html' with chart_id='commentShareChart' %}
</div>
{% endblock %}

{% block extra_script %}
{{ videos|json_script:"videos-data" }}
<script>
    var chartDom = document.getElementById('commentShareChart');
    var myChart = echarts.init(chartDom);
    var videos = JSON.parse(document.getElementById('videos-data').textContent);
    
    var categories = videos.map(function(item, index) {
        var desc = item.description || '视频' + (index + 1);
        return desc.length > 15 ? desc.substring(0, 15) + '...' : desc;
    });
    
    var option = {
        title: {
            text: '评论数与分享数TOP10视频对比',
            left: 'center',
            top: 20,
            textStyle: {
                fontSize: 18,
                fontWeight: 600
            }
        },
        tooltip: {
            trigger: 'axis',
            axisPointer: {
                type: 'cross'
            }
        },
        legend: {
            data: ['评论数', '分享数', '点赞数'],
            top: 60
        },
        grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
        },
        xAxis: {
            type: 'category',
            data: categories,
            axisLabel: {
                interval: 0,
                rotate: 30,
                fontSize: 11
            }
        },
        yAxis: [
            {
                type: 'value',
                name: '数量',
                position: 'left'
            },
            {
                type: 'value',
                name: '点赞数',
                position: 'right'
            }
        ],
        series: [
            {
                name: '评论数',
                type: 'bar',
                data: videos.map(item => item.commentCount || 0),
                itemStyle: {
                    color: '#5470c6'
                }
            },
            {
                name: '分享数',
                type: 'bar',
                data: videos.map(item => item.shareCount || 0),
                itemStyle: {
                    color: '#91cc75'
                }
            },
            {
                name: '点赞数',
                type: 'line',
                yAxisIndex: 1,
                data: videos.map(item => item.likeCount || 0),
                smooth: true,
                itemStyle: {
                    color: '#fac858'
                },
                lineStyle: {
                    width: 3
                }
            }
        ]
    };
    
    myChart.setOption(option);
    
    window.addEventListener('resize', function() {
        myChart.resize();
    });
</script>
{% endblock %}
